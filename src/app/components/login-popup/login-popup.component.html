<!-- login-popup.component.html - OPTIMIZADO -->
<div class="login-popup-overlay" 
     [class.active]="isVisible" 
     (click)="onOverlayClick($event)"
     (keydown)="onKeyDown($event)"
     tabindex="0"
     *ngIf="isVisible">
     
  <div class="login-popup-container">
    <!-- Botón de cerrar -->
    <button class="close-popup-btn" (click)="cerrarPopup()" type="button">×</button>
    
    <!-- Título del popup -->
    <div class="login-popup-header">
      <h2 class="login-title">Login</h2>
    </div>
    
    <!-- ✅ NUEVO: Mensaje de pre-calentamiento -->
    <div class="warm-up-message" *ngIf="isWarmingUp">
      <div class="spinner"></div>
      <p>{{ warmUpMessage }}</p>
    </div>
    
    <!-- Formulario de login -->
    <div class="login-popup-content">
      <form (ngSubmit)="iniciarSesion()" #loginForm="ngForm">
        <!-- Campo Usuario -->
        <div class="form-group">
          <label for="usuario">Usuario:</label>
          <input 
            type="text" 
            id="usuario"
            name="usuario"
            [(ngModel)]="usuario"
            (keypress)="onKeyPress($event)"
            placeholder="Introduce tu usuario"
            required
            autocomplete="username"
            [disabled]="isLoading || isWarmingUp">
        </div>
        
        <!-- Campo Contraseña -->
        <div class="form-group">
          <label for="contrasena">Contraseña:</label>
          <input 
            type="password" 
            id="contrasena"
            name="contrasena"
            [(ngModel)]="contrasena"
            (keypress)="onKeyPress($event)"
            placeholder="Introduce tu contraseña"
            required
            autocomplete="current-password"
            [disabled]="isLoading || isWarmingUp">
        </div>
        
        <!-- Mensaje de error -->
        <div class="error-message" *ngIf="errorMessage">
          <i class="error-icon">⚠️</i>
          {{ errorMessage }}
        </div>
        
        <!-- ✅ Mensaje informativo sobre Render -->
        <div class="info-message" *ngIf="isLoading && fromCheckout">
          <i class="info-icon">ℹ️</i>
          <span>Si es tu primer acceso, el servidor puede tardar 30-60 segundos en responder.</span>
        </div>
        
        <!-- Botón de iniciar sesión -->
        <button 
          type="submit" 
          class="login-btn"
          [disabled]="isLoading || !usuario || !contrasena || isWarmingUp">
          <span *ngIf="!isLoading && !isWarmingUp">INICIAR SESIÓN</span>
          <span *ngIf="isLoading || isWarmingUp" class="loading-text">
            <span class="spinner"></span>
            {{ isWarmingUp ? 'Preparando...' : 'Iniciando sesión...' }}
          </span>
        </button>
      </form>
      
      <!-- Enlace de registro -->
      <div class="register-link">
        <p>¿No estás registrado? 
          <a href="#" (click)="irARegistro(); $event.preventDefault()">¡Regístrate!</a>
        </p>
      </div>
    </div>
  </div>
</div>